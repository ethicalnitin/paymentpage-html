<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dexter Payments</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body class="bg-gray-100">

    <header class="w-full bg-white shadow-md py-4 fixed top-0 left-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center">
            <div class="flex items-center">
                <img src="logo.jpeg" alt="Dexter Luxuries Logo" class="w-10 h-10 md:w-12 md:h-12 rounded-full mr-3">
                <h1 class="text-xl font-bold text-gray-800 uppercase tracking-wide">Dexter Luxuries</h1>
            </div>
            <div class="flex space-x-4">
                <a href="https://wa.me/9557338330" id="whatsappBtn" target="_blank" class="text-green-500 text-2xl hover:text-green-600 transition">
                    <i class="fab fa-whatsapp"></i>
                </a>
                <a href="https://t.me/dextersenior" target="_blank" class="text-blue-500 text-2xl hover:text-blue-600 transition">
                    <i class="fab fa-telegram"></i>
                </a>
            </div>
        </div>
    </header>

   <div class="flex flex-col items-center justify-center min-h-screen py-16 px-4 sm:px-6 lg:px-8 mt-16">
        <div class="w-full max-w-md bg-white p-6 rounded-lg shadow-lg text-center">
            <h1 class="text-2xl font-bold mb-4">Dexter Luxuries - Secure Payment Page</h1>

            <div class="flex gap-4 items-center justify-center">
                <a id="payWithBankAccount" href="#" class="transition-transform transform hover:scale-110">
                    <img src="https://i.ibb.co/6byJHWG/upi-icon.png" alt="Pay with Bank Account" class="h-24 w-24 object-contain" />
                    <p class="text-sm mt-1">Bank Account</p>
                </a>

                <a id="payWithUPI1" href="#" class="transition-transform transform hover:scale-110">
                    <img src="https://i.ibb.co/6byJHWG/upi-icon.png" alt="Pay with UPI-1" class="h-24 w-24 object-contain" />
                    <p class="text-sm mt-1">UPI-1</p>
                </a>

                <a id="payWithUPI2" href="#" class="transition-transform transform hover:scale-110">
                    <img src="https://i.ibb.co/6byJHWG/upi-icon.png" alt="Pay with UPI-2" class="h-24 w-24 object-contain" />
                    <p class="text-sm mt-1">UPI-2</p>
                </a>

                <a id="payWithUPI3" href="#" class="transition-transform transform hover:scale-110">
                    <img src="https://i.ibb.co/6byJHWG/upi-icon.png" alt="Pay with UPI-3" class="h-24 w-24 object-contain" />
                    <p class="text-sm mt-1">UPI-3</p>
                </a>
            </div>

           <div id="qrCodeContainer" class="hidden mt-4">
                <img id="qrCodeImage" src="" alt="QR Code" class="mx-auto mb-3" style="max-width: 200px; height: auto;">
                <p class="text-gray-600 text-sm">Scan the QR code above to complete your payment.</p>
            </div>


            <p class="text-blue-500 cursor-pointer mt-4 mb-2" onclick="openModal()">How will I get access?</p>
           <p class="text-red-500 cursor-pointer mb-4">
                <a href="https://wa.me/+919557338330?text=Payment%20error%20on%20Dexter%20Luxuries" target="_blank">Click here if payment error exists</a>
            </p>

            <div id="accessModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
                <div class="bg-white p-6 rounded-lg shadow-lg max-w-sm">
                    <h2 class="text-xl font-bold mb-4">How to Gain Access</h2>
                    <ol class="list-decimal list-inside text-left space-y-2">
                        <li>Complete the payment and submit your details.</li>
                        <li>Submit your registered email and username.</li>
                        <li>You will be redirected to WhatsApp for instant access.</li>
                    </ol>
                    <button class="mt-4 bg-green-500 text-white py-2 px-4 rounded" onclick="closeModal()">Close</button>
                </div>
            </div>

            <form id="paymentForm" class="space-y-4 mt-4" enctype="multipart/form-data">
                <div class="text-left">
                    <label for="amountDropdown" class="block text-sm font-medium text-gray-700">Amount (â‚¹)*</label>
                    <select id="amountDropdown" name="amountDropdown" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm p-2 bg-gray-100 text-gray-700" required>
                        <option value="399">â‚¹ 399</option>
                        <option value="499">â‚¹ 499</option>
                        <option value="999">â‚¹ 999</option>
                        <option value="1999">â‚¹ 1999</option>
                        <option value="1599">â‚¹ 1599</option>
                        <option value="3999">â‚¹ 3999</option>
                        <option value="5999">â‚¹ 5999</option>
                        <option value="custom">Custom Amount</option>
                    </select>
                </div>

                <div id="customAmountContainer" class="hidden text-left">
                    <label for="customAmount" class="block text-sm font-medium text-gray-700">Enter Custom Amount (â‚¹)*</label>
                    <input type="number" id="customAmount" name="customAmount" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm p-2" placeholder="Enter amount" min="1">
                </div>

                <div class="text-left">
                    <label for="utr" class="block text-sm font-medium text-gray-700">UTR / UPI Reference ID*</label>
                    <input type="text" id="utr" name="utr" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm p-2" placeholder="Enter UTR / UPI Reference ID" required>
                </div>

                <div class="text-left">
                    <label for="email" class="block text-sm font-medium text-gray-700">Email*</label>
                    <input type="email" id="email" name="email" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm p-2" placeholder="Enter your email" required>
                </div>

                <div class="text-left">
                    <label for="username" class="block text-sm font-medium text-gray-700">Username (Optional)</label>
                    <input type="text" id="username" name="username" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm p-2" placeholder="Enter your username (if applicable)">
                </div>

                <div class="text-left">
                    <label for="paymentScreenshot" class="block text-sm font-medium text-gray-700">Upload Payment Screenshot*</label>
                    <input type="file" id="paymentScreenshot" name="paymentScreenshot" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm p-2" accept="image/*" required>
                </div>

                <button type="submit" id="submitPaymentBtn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition">Submit Payment</button>
            </form>


            <div id="paymentSuccessModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex justify-center items-center">
                <div class="bg-white p-6 rounded-lg shadow-lg text-center">
                    <h2 class="text-xl font-bold mb-4">Payment Successful!ðŸŸ©</h2>
                    <p class="mb-4">You will be redirected to WhatsApp in <span id="countdown">3</span> seconds...</p>
                    <button
                        id="closeModalBtn"
                        class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg"
                    >
                        Close
                    </button>
                </div>
            </div>

        <script>
            const payWithBankAccountButton = document.getElementById('payWithBankAccount');
            const payWithUPI1Button = document.getElementById('payWithUPI1');
            const payWithUPI2Button = document.getElementById('payWithUPI2');
            const payWithUPI3Button = document.getElementById('payWithUPI3');
            const qrCodeContainer = document.getElementById('qrCodeContainer');
            const qrCodeImage = document.getElementById('qrCodeImage');

            // Define the QR codes
            const upiQRCode ="https://branch-panel-data.s3.ap-south-1.amazonaws.com/images/qr_code/1744903445.png";
            // If you have different QR codes for each UPI option, define them here:
             const upi1QRCode = "https://branch-panel-data.s3.ap-south-1.amazonaws.com/images/qr_code/1744903445.png";
             const upi2QRCode = "https://branch-panel-data.s3.ap-south-1.amazonaws.com/images/qr_code/1743184787.jpeg";
             const upi3QRCode = "https://branch-panel-data.s3.ap-south-1.amazonaws.com/images/qr_code/1743864642.jpeg";

            // Event listener for "Pay with Bank Account"
            payWithBankAccountButton.addEventListener('click', () => {
                qrCodeContainer.classList.remove('hidden');
                qrCodeImage.src = upiQRCode;
            });

            // Event listener for "Pay with UPI-1"
            payWithUPI1Button.addEventListener('click', () => {
                qrCodeContainer.classList.remove('hidden');
                qrCodeImage.src = upi1QRCode ; // Replace with upi1QRCode if available
            });

            // Event listener for "Pay with UPI-2"
            payWithUPI2Button.addEventListener('click', () => {
                qrCodeContainer.classList.remove('hidden');
                qrCodeImage.src = upi2QRCode; // Replace with upi2QRCode if available
            });

            // Event listener for "Pay with UPI-3"
            payWithUPI3Button.addEventListener('click', () => {
                qrCodeContainer.classList.remove('hidden');
                qrCodeImage.src = upi3QRCode; // Replace with upi3QRCode if available
            });

            // Function to open the modal
            function openModal() {
                const modal = document.getElementById('accessModal');
                modal.classList.remove('hidden');

                // Automatically close the modal after 4 seconds
                setTimeout(closeModal, 4000);
            }

            // Function to close the modal
            function closeModal() {
                const modal = document.getElementById('accessModal');
                modal.classList.add('hidden');
            }

            // Get the amount from the URL parameters
            function getUrlParameter(name) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(name);
            }

            // Show/Hide Custom Amount Field and Set Default Amount
            document.addEventListener('DOMContentLoaded', function() {
                const amountDropdown = document.getElementById('amountDropdown');
                const customAmountContainer = document.getElementById('customAmountContainer');
                const urlAmount = getUrlParameter('amount');
                const amountInput = document.getElementById('amount'); // Get the readonly amount input

                if (urlAmount) {
                    // Check if the amount passed in the URL matches one of the dropdown values
                    const isPreset = [...amountDropdown.options].some(option => option.value === urlAmount);

                    if (isPreset) {
                        amountDropdown.value = urlAmount;
                    } else {
                        // If the amount isn't preset, show custom amount input
                        amountDropdown.value = 'custom';
                        customAmountContainer.classList.remove('hidden');
                        document.getElementById('customAmount').value = urlAmount;
                    }
                } else {
                    // Set the default value of the dropdown
                    amountDropdown.value = '399';
                }

                // Show the custom amount field when 'custom' is selected
                amountDropdown.addEventListener('change', function() {
                    if (amountDropdown.value === 'custom') {
                        customAmountContainer.classList.remove('hidden');
                    } else {
                        customAmountContainer.classList.add('hidden');
                    }
                });
            });

            // Form Submission Event Listener
            document.getElementById('paymentForm').addEventListener('submit', async function(event) {
                event.preventDefault(); // Prevent default form submission

                const submitPaymentBtn = document.getElementById('submitPaymentBtn');
                submitPaymentBtn.innerHTML = 'Processing...'; // Show loading state
                submitPaymentBtn.disabled = true; // Disable button to prevent multiple submissions

                const form = event.target;
                const formData = new FormData(form);

                // Get the selected amount
                const selectedAmount = formData.get('amountDropdown') === 'custom' ? formData.get('customAmount') : formData.get('amountDropdown');

                const data = {
                    amountDropdown: selectedAmount,
                    utr: formData.get('utr'),
                    email: formData.get('email'),
                    username: formData.get('username'),
                    paymentScreenshot: formData.get('paymentScreenshot') // Include the file
                };

                // Facebook Pixel Purchase Tracking (Browser-Side)
                if (window.fbq) {
                    window.fbq('track', 'Purchase', {
                        value: selectedAmount,
                        currency: 'INR'
                    });
                }

                // Conversion API (CAPI) Purchase Event
                try {
                    const userAgent = navigator.userAgent;
                    const capiResponse = await fetch('https://backend-cmfshop.onrender.com/track-event', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            event_name: 'Purchase',
                            event_time: Math.floor(Date.now() / 1000),
                            action_source: 'website',
                            event_source_url: window.location.href,
                            custom_data: {
                                value: selectedAmount,
                                currency: 'INR'
                            },
                            user_data: {
                                client_user_agent: userAgent,
                            }
                        }),
                    });
                    const capiResult = await capiResponse.json();
                    console.log('Purchase event sent via CAPI:', capiResult);
                } catch (error) {
                    console.error('Error sending Purchase via CAPI:', error);
                }

                // Send form data to backend for Telegram notification
                try {
                    const telegramResponse = await fetch('https://backend-cmfshop.onrender.com/submit', {
                        method: 'POST',
                        body: formData // Send the FormData object directly, including file upload
                    });

                    if (telegramResponse.ok) {
                        console.log('Form data sent to Telegram successfully');
                    } else {
                        console.error('Error sending form data to Telegram:', await telegramResponse.json());
                    }
                } catch (error) {
                    console.error('Error processing form submission:', error);
                }

                // Display Modal on Successful Payment Submission
                const modal = document.getElementById('paymentSuccessModal');
                modal.classList.remove('hidden');

                // Countdown Timer
                let countdown = 3;
                const countdownElement = document.getElementById('countdown');
                const countdownInterval = setInterval(() => {
                    countdown -= 1;
                    countdownElement.textContent = countdown;
                    if (countdown === 0) {
                        clearInterval(countdownInterval);
                        modal.classList.add('hidden'); // Close the modal
                        window.location.href = 'https://wa.me/+919557338330?text=I%20have%20submitted%20my%20payment%20details';
                    }
                }, 1000); // Decrease countdown every second

                // Reset the button
                submitPaymentBtn.innerHTML = 'Submit Payment';
                submitPaymentBtn.disabled = false;
            });
        </script>
        </div>
    </div>

</body>
</html>
